<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CheckoutOrderUseCaseImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Snack bar</a> &gt; <a href="index.source.html" class="el_package">com.snackbar.checkout.usecase</a> &gt; <span class="el_source">CheckoutOrderUseCaseImpl.java</span></div><h1>CheckoutOrderUseCaseImpl.java</h1><pre class="source lang-java linenums">package com.snackbar.checkout.usecase;

import com.snackbar.basket.application.usecases.BasketUseCase;
import com.snackbar.basket.domain.entity.Basket;
import com.snackbar.checkout.gateway.CheckoutRepository;
import com.snackbar.orderRefactory.domain.entity.Order;
import com.snackbar.orderRefactory.domain.entity.OrderItem;
import com.snackbar.orderRefactory.domain.valueobject.StatusOrder;
import com.snackbar.orderRefactory.application.usecases.OrderUseCase;
import com.snackbar.payment.application.usecases.CreatePaymentUseCase;
import com.snackbar.payment.domain.entity.Payment;
import org.springframework.stereotype.Component;

import java.math.BigDecimal;
import java.util.stream.Collectors;

@Component
public class CheckoutOrderUseCaseImpl implements CheckoutOrderUseCase {

    private final CheckoutRepository checkoutRepository;
    private final BasketUseCase basketUseCase;
    private final OrderUseCase orderUseCase;
    private final CreatePaymentUseCase createPaymentUseCase;

<span class="nc" id="L25">    public CheckoutOrderUseCaseImpl(</span>
            CheckoutRepository checkoutRepository,
            BasketUseCase basketUseCase,
            OrderUseCase orderUseCase,
            CreatePaymentUseCase createPaymentUseCase
    ) {
<span class="nc" id="L31">        this.checkoutRepository = checkoutRepository;</span>
<span class="nc" id="L32">        this.basketUseCase = basketUseCase;</span>
<span class="nc" id="L33">        this.orderUseCase = orderUseCase;</span>
<span class="nc" id="L34">        this.createPaymentUseCase = createPaymentUseCase;</span>
<span class="nc" id="L35">    }</span>

    @Override
    public Order checkout(String basketId) {
<span class="nc" id="L39">        Basket basket = basketUseCase.findBasket(basketId);</span>

<span class="nc" id="L41">        Order order = new Order();</span>
<span class="nc" id="L42">        order.setCpf(basket.cpf());</span>
<span class="nc" id="L43">        order.setStatusOrder(StatusOrder.NOVO);</span>
<span class="nc" id="L44">        order.setTotalPrice(basket.totalPrice());</span>
<span class="nc" id="L45">        order.setPaymentMethod(&quot;mercado_pago&quot;);</span>
<span class="nc" id="L46">        order.setItems(basket.items().stream().map(item -&gt; {</span>
<span class="nc" id="L47">            OrderItem orderItem = new OrderItem();</span>
<span class="nc" id="L48">            orderItem.setName(item.name());</span>
<span class="nc" id="L49">            orderItem.setQuantity(item.quantity());</span>
<span class="nc" id="L50">            return orderItem;</span>
<span class="nc" id="L51">        }).collect(Collectors.toList()));</span>

<span class="nc" id="L53">        Order orderCreated = this.orderUseCase.createOrder(order);</span>

<span class="nc" id="L55">        return orderCreated;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>